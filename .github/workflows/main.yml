name: CI
on:
  push:
    branches: main
    paths: 'package.json'
jobs:
  Create-Github-Release:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Read package.json version
        run: |
          package_version=`grep version ${{ github.workspace }}/package.json | awk -F \" '{print $4}'`
          current_version=`gh release list --limit 1 | grep -oE  "([0-9]+)\.([0-9]+)\.([0-9]+)" | head -1`
          # Check if package_version > current_version:
          ${{ github.workspace }}/semver.sh +x
          ${{ github.workspace }}/semver.sh $package_version $current_version
          gh release create v$package_version --generate-notes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}